<!DOCTYPE html>
<html>
<head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123786627-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-123786627-1');
	</script>
	<title>網址識別工具</title>
</head>
<body style="background-color:powderblue">	
	<h3 align="center">原網址: <input id="urlTextBox" size="100" type="text"><br>
	<br>
	<button onclick="convert()">轉換</button></h3>
	<h3 align="center">轉換後的網址: <input id="resultTextBox" size="100" type="text"><br>
	<br>
	<button disabled id="goHentai" onclick="referrerHentai()">轉對了嗎?發車嘍</button></h3>
	
	<script>
	function convert() {
		document.getElementById("resultTextBox").value = '';
	    document.getElementById("goHentai").setAttribute("disabled",'');
		
	    var source = document.getElementById("urlTextBox").value.replace(" ", "");
	    var result = '';
	   
		if (source.length == 0) { alert('未輸入網址'); return;} 
		if (!source.startsWith("http")) if (!confirm('原網址非http開頭，請確認是否繼續')) return;
	   
		for (var i = 0; i < source.length; i++) {
			var charInt = source.charCodeAt(i);
	        if (charInt == 37) { i += 2; continue; }
	        if ((charInt >= 45 && charInt <= 47) || charInt== 58 || (charInt >= 48 && charInt <= 57) || (charInt >= 65 && charInt <= 90) || 
			(charInt >= 97 && charInt <= 122) && (charInt < 0x4E00 || charInt > 0x9FA5)) result += String.fromCharCode(charInt);
	    }   
	   
	    if (result.length != 0) {
			document.getElementById("resultTextBox").value = result;			
	        if (result.startsWith("http")) {			
				document.getElementById("goHentai").firstChild.data = '轉對了嗎?發車嘍';
				document.getElementById("goHentai").removeAttribute("disabled");
				gtag('event', 'ConvertURL', { 
				'event_category': 'Success',
				'event_label' : source,
				'non_interaction': false
				});
			}
			else 
			{
				gtag('event', 'ConvertURL', { 
				'event_category': 'Fail',
				'event_label' : source,
				'non_interaction': false
				});
				document.getElementById("goHentai").firstChild.data = '網址非http開頭，無法發車';
			}
	    }
	}

	function referrerHentai() {
		gtag('event', 'GoGoGo', { 'event_category': document.getElementById("resultTextBox").value, 'non_interaction': false });
		window.open( document.getElementById("resultTextBox").value);
	}
	</script>
</body>
</html>
